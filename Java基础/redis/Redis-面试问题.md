# Redis问题

| 类型     | 问题                                                         | 解决方案                                                     |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 换穿击穿 | 当查询数据的时候，对应的缓存数据的key刚好过期，导致请求被打到数据库上（热点key不存在，请求到数据库） | 1.设置缓存永不过期(不推荐)<br/>2.分布式应用使用分布式锁，单体应用使用互斥锁 |
| 缓存穿透 | 查询缓存和数据库都不存在的数据（恶意请求，黑客攻击）         | 1.查询为null的数据也缓存到redis<br/>2.对ip进行限制<br/>3.参数合法性校验，如id为负数<br/>4.使用布隆过滤器（将所有数据存放到布隆过滤器，如果布隆过滤器中不存在，直接返回） |
| 缓存雪崩 | redis缓存key在同一时间大量失效，导致大量请求全部达到数据库，造成数据库挂掉 | 1.设置缓存时间，不要在同一时间失效（可以通过添加随机数）<br/>2.redis集群部署，让key平均分布到不通的节点上<br/>3.不设置key过期，永久生效<br/>4.定时认任务刷新缓存 |

## 布隆过滤器

> 解决缓存穿透问题，将所有的数据存到布隆过滤器中，通过0和1表示，0-不存在，1-存在。原理是通过多个hash函数计算得到数组对应的index，查询的时候只有当所有位置的数据都为1时才表示存在，否则不存在，它的时间复杂度是O(1)到O(n)，n代表hash函数的个数，hash函数越多效率越低，错判率也越低，数据越精准。为什么要用多个hash函数，因为不通的数据经过hash运算后的结果有可能是一样的，所以要进行多次运算。推荐用guava提供的BloomFilter工具类
